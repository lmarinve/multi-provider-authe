<!DOCTYPE html>
<html>
<head>
    <title>Config Test</title>
</head>
<body>
    <h1>Configuration Test</h1>
    <div id="results"></div>
    
    <script type="module">
        // Simulate the configuration
        const config = {
            cilogon: {
                clientId: "cilogon:/client_id/e33e29a20f84e0edd144d1e9a6e2b0",
                scope: "openid",
                authUrl: "https://cilogon.org/authorize",
                tokenUrl: "https://cilogon.org/oauth2/token",
                redirectUri: "https://lmarinve.github.io/multi-provider-authe/auth/callback/cilogon",
                usePkce: true
            }
        };

        function generateState() {
            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            return btoa(String.fromCharCode(...array))
                .replace(/\+/g, "-")
                .replace(/\//g, "_")
                .replace(/=+/g, "");
        }

        function generateCodeVerifier() {
            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            return btoa(String.fromCharCode(...array))
                .replace(/\+/g, "-")
                .replace(/\//g, "_")
                .replace(/=+/g, "");
        }

        async function generateCodeChallenge(verifier) {
            const digest = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(verifier));
            return btoa(String.fromCharCode(...new Uint8Array(digest)))
                .replace(/\+/g, "-")
                .replace(/\//g, "_")
                .replace(/=+/g, "");
        }

        async function testConfig() {
            const state = generateState();
            const verifier = generateCodeVerifier();
            const challenge = await generateCodeChallenge(verifier);
            
            const params = new URLSearchParams({
                response_type: 'code',
                client_id: config.cilogon.clientId,
                redirect_uri: config.cilogon.redirectUri,
                scope: config.cilogon.scope,
                state: state,
                code_challenge: challenge,
                code_challenge_method: 'S256'
            });

            const authUrl = `${config.cilogon.authUrl}?${params.toString()}`;
            
            document.getElementById('results').innerHTML = `
                <h2>Generated Configuration:</h2>
                <p><strong>Client ID:</strong> ${config.cilogon.clientId}</p>
                <p><strong>Redirect URI:</strong> ${config.cilogon.redirectUri}</p>
                <p><strong>Scope:</strong> ${config.cilogon.scope}</p>
                <p><strong>State:</strong> ${state}</p>
                <p><strong>Code Verifier Length:</strong> ${verifier.length}</p>
                <p><strong>Code Challenge:</strong> ${challenge}</p>
                <h3>Auth URL:</h3>
                <p style="word-break: break-all; background: #f5f5f5; padding: 10px; font-family: monospace;">
                    ${authUrl}
                </p>
                <br>
                <a href="${authUrl}" target="_blank" style="background: #007cba; color: white; padding: 10px 20px; text-decoration: none;">
                    Test CILogon Auth
                </a>
            `;
        }

        testConfig();
    </script>
</body>
</html>