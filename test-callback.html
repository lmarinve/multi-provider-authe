<!DOCTYPE html>
<html>
<head>
    <title>Test Callback</title>
</head>
<body>
    <h1>Test Callback Processing</h1>
    <div id="debug"></div>
    
    <script>
        const debug = document.getElementById('debug');
        
        // Parse the URL from your example
        const testUrl = "https://lmarinve.github.io/multi-provider-authe/auth/callback/cilogon?code=NB2HI4DTHIXS6Y3JNRXWO33OFZXXEZZPN5QXK5DIGIXTMNJVGBTGEMLGGQ2GCOJUMQ2TCYRWMI4DKODEMEYDQMTDGYZDMNB7OR4XAZJ5MF2XI2D2I5ZGC3TUEZ2HGPJRG42TMNRXGU3DOMZWGYYSM5TFOJZWS33OHV3DELRQEZWGSZTFORUW2ZJ5HEYDAMBQGA&state=ReJ1U3fh5AhrUggO2g1Hys_QXpYm2_Crtp0s6xXKuuQ";
        
        const url = new URL(testUrl);
        const code = url.searchParams.get('code');
        const state = url.searchParams.get('state');
        
        debug.innerHTML = `
            <h2>Parsed Parameters:</h2>
            <p><strong>Code:</strong> ${code ? code.substring(0, 50) + '...' : 'Missing'}</p>
            <p><strong>State:</strong> ${state}</p>
            <p><strong>Code Length:</strong> ${code ? code.length : 0}</p>
            <p><strong>State Length:</strong> ${state ? state.length : 0}</p>
            
            <h2>Storage Debug:</h2>
            <p><strong>SessionStorage pkce:</strong> ${sessionStorage.getItem('pkce')}</p>
            <p><strong>LocalStorage pkce_${state}:</strong> ${localStorage.getItem(`pkce_${state}`)}</p>
            <p><strong>SessionStorage cilogon_state:</strong> ${sessionStorage.getItem('cilogon_state')}</p>
            <p><strong>SessionStorage cilogon_code_verifier:</strong> ${sessionStorage.getItem('cilogon_code_verifier')}</p>
        `;
    </script>
</body>
</html>